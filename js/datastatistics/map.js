/**
 * 地图js
 **/

String.prototype.myReplace=function(f,e){
        var reg=new RegExp(f,"g");
        return this.replace(reg,e);
    }
    //创建和初始化地图函数：
    function initMap(){
        createMap();//创建地图
        setMapEvent();//设置地图事件
        // addMapControl();//向地图添加控件
        addMarker();//向地图中添加marker
        // hiddenText(); //隐藏地图文本信息
    }

    /**
     * 添加地图边界
     */
    function setBoundaries()
    {
        var pointArray = [];
        var bdary = new BMap.Boundary();
        //清除地图覆盖物
        map.clearOverlays();
        var PolygonOptions = {
            strokeWeight:3,
            strokeColor:"#000",
            strokeOpacity:0.5,
            fillColor:""
        }
		var pos = "117.08364010292,40.245394716879;117.08324086144,40.245378443383;117.08277495858,40.245238209668;117.0823930368,40.244974491541;117.08214636358,40.244707797111;117.08167628175,40.243953238072;117.07993187913,40.244051057338;117.07963821355,40.244009092663;117.07896016046,40.243567408088;117.0780196192,40.243571946502;117.07783068046,40.243548845023;117.07777610483,40.243474242175;117.07760708563,40.242924100458;117.07705966581,40.239948369334;117.07636860856,40.237616221398;117.07642677812,40.237305612491;117.07677159025,40.2367556835;117.07643657594,40.235837895556;117.07611637233,40.235272698244;117.07527699186,40.234031062087;117.07498371279,40.23376261251;117.07350757923,40.23375449539;117.07335870783,40.233724241439;117.07277557512,40.233339817429;117.0720244627,40.233100235058;117.07058998727,40.232805200947;117.06781371375,40.232607123416;117.06672093676,40.2322087651;117.06594424679,40.232363357119;117.06495614655,40.232208501672;117.06379886466,40.232176562992;117.06288638682,40.232013687521;117.06225206973,40.23170471491;117.06090383903,40.231825405886;117.05928907511,40.231735787396;117.0589328729,40.231833516187;117.05824574465,40.232575204435;117.05784919261,40.232840693028;117.05700119403,40.232963734546;117.05582499807,40.232942164404;117.05494515781,40.232749005717;117.05477102478,40.233581236842;117.05475910257,40.234167321317;117.05467253238,40.234306325866;117.05414126875,40.234002878708;117.05299484911,40.233121182323;117.05146229307,40.232570670601;117.05138497962,40.233050493722;117.0513913868,40.234331654781;117.05127258471,40.234419750722;117.05078014561,40.23437395723;117.05077753021,40.232919128338;117.0508226948,40.232451642089;117.05090878786,40.232309689235;117.05081856123,40.232197504042;117.05054301134,40.232117681584;117.05047162321,40.232220388729;117.05040743126,40.233009346029;117.05039970278,40.234778448387;117.05024816232,40.234810104494;117.0499624958,40.234592448284;117.04963784551,40.234627136049;117.04880608624,40.23471808599;117.04812253857,40.234973479534;117.04743805838,40.234698258935;117.04723406407,40.23466777604;117.04688770152,40.234747509261;117.04678872066,40.235302729537;117.04679825814,40.236652402316;117.04519242417,40.23658819788;117.04470817582,40.236419890028;117.04426973391,40.236136157327;117.04428283073,40.235670713872;117.04407573807,40.235557828225;117.0433845799,40.235695992627;117.04296707483,40.23599803767;117.04278558717,40.236719484471;117.04252877879,40.237013106124;117.04200559867,40.237335006067;117.04175069498,40.237348978233;117.04111097559,40.237076277417;117.0392781293,40.236901355395;117.0390559254,40.237093903633;117.03905591215,40.237301689881;117.03888281018,40.237798247373;117.03799735021,40.239363745251;117.03793767229,40.240225502618;117.0382320272,40.241003224597;117.04030213729,40.242081144931;117.04127448672,40.2424793501;117.04131702672,40.242588717863;117.04117341779,40.242730677159;117.03999587897,40.242926654614;117.03901717531,40.243325669588;117.03872803216,40.243513992861;117.038668169,40.243728808284;117.03879450927,40.243840973975;117.03923946662,40.243781109072;117.03957191735,40.243819856511;117.03977904089,40.243946855305;117.03980354281,40.244104539759;117.03961634193,40.244639244395;117.03945248214,40.244831787024;117.03816709146,40.24597008945;117.03795668915,40.246391325041;117.03787049302,40.246791583197;117.03796048628,40.247454146161;117.03823998117,40.247984428696;117.03874758096,40.248650785954;117.03911728466,40.248918004182;117.03981149572,40.249655081162;117.04031343398,40.250497369155;117.03995724559,40.251646319656;117.04019839317,40.252207431343;117.04022931017,40.252472918029;117.04000560522,40.253391121356;117.04004102406,40.253473469236;117.04037635421,40.253627457627;117.04018386481,40.254048267111;117.04010860453,40.255286771067;117.04059550834,40.255320628258;117.04053343856,40.255775428395;117.04047104291,40.255968270569;117.04022322349,40.255952098563;117.04018352394,40.256094368066;117.04006966339,40.25614224152;117.03815155876,40.256144678615;117.03646418884,40.256265770695;117.03639941687,40.256353732261;117.03641316326,40.256867370323;117.03652729194,40.25745645859;117.03604751732,40.257626845035;117.0359455137,40.257830464959;117.03625202319,40.258778057452;117.03595053465,40.258909660827;117.0342276062,40.259123268897;117.03393708382,40.259511705666;117.03393252732,40.260293586;117.03386170996,40.260420421524;117.03305064464,40.260538639468;117.03304005524,40.261052704181;117.03297640053,40.261112692487;117.03219361999,40.261378344267;117.03151719273,40.261494472188;117.03104892573,40.261720194114;117.0309485234,40.261973601971;117.03097589638,40.262170264844;117.03127550383,40.262781377843;117.03077380824,40.263151645533;117.03067073402,40.263345975888;117.03085018095,40.263748514547;117.03172434609,40.264284148266;117.03175855621,40.26446495546;117.03140645727,40.264770821945;117.03124312789,40.265448912558;117.03103860843,40.265833770171;117.03055926068,40.26596471435;117.03015564192,40.266252647778;117.02969984476,40.26634292942;117.02953296737,40.266498454074;117.02941019497,40.266756805128;117.02883909405,40.267050939506;117.02873168757,40.267232261152;117.02892589229,40.267292716313;117.02975958435,40.267188770016;117.02992456811,40.267296300864;117.02996989913,40.267538760217;117.02905839983,40.268219508311;117.02861014652,40.268744451285;117.02838842872,40.269204267651;117.02818406659,40.269780110605;117.02814468302,40.271009176865;117.02820983146,40.271352215634;117.02800192622,40.271371115741;117.02775232374,40.271067443953;117.02745210352,40.27093134341;117.02733906352,40.270756919328;117.02733243812,40.270273525341;117.02757908224,40.269113228946;117.0275560089,40.268718780151;117.02743294348,40.268477546306;117.02728446292,40.268562666159;117.0267309164,40.269487592605;117.02672163411,40.269775725706;117.02649889817,40.270509267003;117.0262235144,40.270982475644;117.02597038489,40.27187345299;117.02570732725,40.272324709321;117.02556926023,40.272987155331;117.02563282671,40.273254369137;117.02581330832,40.273611969678;117.026456356,40.274280370926;117.02780675102,40.27504118987;117.0278704296,40.275220477452;117.02686956112,40.276164461028;117.02651709361,40.276876790929;117.02512044251,40.277920313337;117.02316006408,40.279098570513;117.02311434254,40.27935820169;117.02349125166,40.281334229221;117.02339073234,40.281626657539;117.02254554362,40.282345737995;117.02232206735,40.282750975791;117.02218139746,40.283249452395;117.02191781883,40.283334066267;117.02104452177,40.283312594709;117.02084065324,40.283435584924;117.02070538065,40.283668888885;117.02066967803,40.284147204743;117.02057092745,40.28437217868;117.01913522222,40.285355532427;117.01874176584,40.285799845265;117.01815348913,40.286652136822;117.01772968184,40.28707233487;117.01622908836,40.288626836787;117.01595759399,40.289179587828;117.0158181888,40.290275242271;117.01572451301,40.290542680346;117.01522846148,40.290878304489;117.01443037702,40.29098628519;117.01386516235,40.291399420769;117.01356280377,40.291374917833;117.01340181225,40.291500221148;117.01338979268,40.291732214297;117.01379048907,40.292103822431;117.01410996817,40.292286549606;117.01423176551,40.292460075539;117.01394166825,40.293677100372;117.01409063475,40.29410244974;117.0143658208,40.29438525285;117.01439219015,40.29449925576;117.01366661354,40.295084128832;117.01360922014,40.295460488949;117.01368615151,40.296002222035;117.0134088127,40.296273184375;117.01250030004,40.296710402459;117.01219645071,40.297299962492;117.01220054294,40.297582063634;117.01205274009,40.298155530007;117.01202537653,40.298920409989;117.01178926472,40.299253967673;117.01086939647,40.300070526048;117.01095093531,40.300261430069;117.01103488374,40.301444424414;117.01140565566,40.302076998869;117.01128809752,40.302387374653;117.01135577124,40.303273117428;117.0109111372,40.303625110867;117.00975009743,40.304006883249;117.00965242994,40.304254081683;117.00989319698,40.304633939628;117.00985118225,40.304826165777;117.00956449057,40.305020252948;117.0094597889,40.305286179467;117.00902658729,40.305625425302;117.00884669169,40.305857297058;117.00890925836,40.306116249759;117.00942828731,40.306435549549;117.01069467767,40.306831815804;117.01114118998,40.307630542014;117.01155016069,40.30819702635;117.01178995427,40.308404739619;117.01210605056,40.308466831451;117.01279722972,40.308427049696;117.01318096392,40.308684588695;117.0138222307,40.309360515669;117.01452177158,40.309495702138;117.01514624836,40.310270598808;117.01515885963,40.311219887966;117.01555665793,40.312079162101;117.01632608012,40.312372768863;117.01690823923,40.312791156599;117.01760845182,40.312959530798;117.01784865244,40.313082700572;117.01819783077,40.313280377549;117.01836737203,40.313524945596;117.01835672201,40.313834119316;117.01803944377,40.314407851348;117.01777310746,40.315309043808;117.01772503537,40.315770557133;117.01741176986,40.316160941283;117.01755049405,40.316674298712;117.01757271378,40.317491385438;117.01734098079,40.317705906877;117.0154235564,40.318899228669;117.01536106034,40.318981698121;117.0154026021,40.319189210955;117.01530786406,40.319999180965;117.01516414497,40.320200890875;117.01471776318,40.320482303527;117.01445096267,40.320787716682;117.01442720429,40.320972689765;117.01459120764,40.32154428756;117.01435189803,40.322140637582;117.01440659442,40.322454464841;117.01435255195,40.322816861779;117.01409223104,40.323313997691;117.01408647707,40.323548494765;117.01430585241,40.324289611583;117.01403739199,40.324796836826;117.01388221281,40.325444861242;117.01397320437,40.325889795803;117.01474901141,40.326603684496;117.01613927704,40.326952431521;117.01656450057,40.326842450041;117.01686606004,40.326855890873;117.01728969556,40.326978772788;117.01749184537,40.327154771827;117.01789105397,40.327832088917;117.01783608733,40.328412558421;117.01790494461,40.328670182687;117.01831641724,40.329319287762;117.0182496341,40.330081168421;117.01849539859,40.330822600701;117.01911380229,40.331668913204;117.01940232817,40.332661779547;117.01962261202,40.332896120993;117.02021425583,40.332917851195;117.02105708927,40.333126115955;117.02186321665,40.333539254902;117.02220468457,40.333832648448;117.0223420099,40.334701845252;117.02223938216,40.335143909937;117.02223997173,40.335505072669;117.02254355017,40.336410251502;117.0231089612,40.337176312991;117.02364176167,40.337671566595;117.02474897601,40.337997781175;117.02535954087,40.338346449945;117.02587624392,40.338911018511;117.02597161926,40.339158083302;117.0259459668,40.33985854443;117.02637171512,40.340217359385;117.0266884032,40.340991345556;117.02769906254,40.342144457153;117.02787700873,40.342251966774;117.02814492956,40.342264364582;117.02835834702,40.342359584132;117.02853636628,40.342556313091;117.02927966679,40.343049811331;117.03024098474,40.342967117192;117.03127267963,40.343550372222;117.03209873389,40.3438062681;117.03301318695,40.344383575306;117.03477972569,40.344621852793;117.03542163397,40.344353759204;117.03584733365,40.344074124666;117.03612110315,40.344008891558;117.03699467567,40.344022509503;117.0377154874,40.343770046557;117.03884263024,40.343772879077;117.03915295958,40.343700239528;117.03976450836,40.343408646666;117.03992338068,40.343421253125;117.0407442245,40.343996956262;117.04143416074,40.344374597611;117.04292975968,40.344425508508;117.04376853494,40.344316175806;117.04521633521,40.344491928336;117.04598547337,40.344700536655;117.04633620643,40.345100809343;117.04645156191,40.345579476783;117.04643855303,40.345745729336;117.04665876698,40.345941656148;117.04740115421,40.345934132422;117.04845815269,40.346011716869;117.04873194108,40.346090417002;117.0495684783,40.345758153185;117.05053118021,40.345665236218;117.05092178955,40.345788016822;117.05148363646,40.345651991589;117.05279813486,40.346060883287;117.05433071566,40.346159563409;117.05458487371,40.346394737002;117.05500806314,40.346585854855;117.05510014642,40.346726247613;117.05527749044,40.346990843455;117.05557894175,40.34723278068;117.0563795713,40.346964836455;117.05673523648,40.346936325567;117.05682499978,40.346857648632;117.05680337936,40.346583819839;117.05688494307,40.346433052028;117.05730079794,40.346068286242;117.05776085382,40.346086395727;117.05827213041,40.345847624126;117.05866028678,40.345384251876;117.05879499832,40.345036787135;117.05945164438,40.344428218602;117.06016031124,40.343316947935;117.06086074049,40.342831296111;117.06187327463,40.342471069294;117.06210556228,40.342470584789;117.06238598717,40.342585268314;117.06289718224,40.343019339695;117.06480304316,40.343151268591;117.06521386109,40.343432529965;117.06614871449,40.343501669787;117.06695218229,40.342969807224;117.0674287469,40.343028123635;117.06810602896,40.343329214342;117.06831081277,40.343470068683;117.06844156581,40.344071534691;117.06907687873,40.344894109841;117.07012501039,40.345754172602;117.07041935734,40.346543084975;117.07055487993,40.346677882431;117.07140031524,40.346723984811;117.07160373853,40.346785159356;117.07199143356,40.347171779636;117.07249542818,40.347392325397;117.07294417805,40.34776687405;117.07323297991,40.348386394428;117.07351723996,40.348533622531;117.07432701198,40.348695450312;117.07511526049,40.348252692083;117.0764944145,40.3483005298;117.07712033102,40.34818946752;117.07800902705,40.348474812653;117.07830802889,40.348643440496;117.07842518454,40.349003888175;117.0785330457,40.349077211816;117.07967867499,40.348772655691;117.079830229,40.350448054925;117.07983028306,40.350649896342;117.0800944045,40.351363540802;117.08053987238,40.351423750011;117.08142072455,40.351811955995;117.08286040866,40.353085690939;117.08357695899,40.353883604141;117.0836938691,40.354222481328;117.08482604207,40.353869442523;117.08544237051,40.353832730264;117.08587544372,40.353928982966;117.08689042734,40.354438313719;117.08831168081,40.354787272829;117.08939314506,40.355273879425;117.09039355723,40.355410356703;117.09100130599,40.355868669376;117.09259491439,40.35641671752;117.09292055765,40.356764961581;117.09422440539,40.357670940129;117.09463759966,40.358072680152;117.09559042727,40.358443984947;117.0957338122,40.358565988794;117.09581248619,40.358814285991;117.09581267322,40.35933346833;117.09613815384,40.36004447051;117.09634216528,40.36021967538;117.09681390187,40.360098478804;117.09730394344,40.36009696677;117.09745325587,40.36018489976;117.09779764634,40.360615494575;117.09847255479,40.360856330228;117.09889145953,40.36082334667;117.09980363337,40.361004687441;117.10011790695,40.361211672247;117.1004722886,40.361649107153;117.10082955759,40.362334750016;117.10140982872,40.362868393194;117.10147758792,40.363377629957;117.10143266632,40.363816767802;117.10181204881,40.36438769841;117.10262810847,40.36462643009;117.10313944828,40.365033528602;117.1032413096,40.365185287038;117.1039759398,40.365652245942;117.10431026112,40.365841015973;117.1052879856,40.365795840438;117.10550995091,40.365850495579;117.10636118693,40.366092441518;117.10638905342,40.366472058578;117.10646375551,40.366524246043;117.10819343499,40.36680937952;117.10860601993,40.366391642967;117.10913142066,40.366042443192;117.10914523917,40.365933883443;117.11023127679,40.365271254618;117.11114316207,40.365107602258;117.11192034211,40.365221583598;117.11233306451,40.365193956767;117.11278558456,40.365065521344;117.11341957019,40.364648299959;117.1141413249,40.364603060902;117.11453134192,40.364498285615;117.11543701438,40.364080791396;117.1158671798,40.363981694424;117.11637972268,40.363556644598;117.11655632339,40.363499137269;117.11675180934,40.363588781498;117.11709826457,40.363560907872;117.11785554105,40.363094987933;117.11807100705,40.362732689421;117.11814384889,40.362530369273;117.11812308651,40.362308063678;117.11794759813,40.362005883717;117.11809537227,40.361793847294;117.11846853979,40.361548502325;117.11874298881,40.361259469146;117.11900737441,40.361250221999;117.11953464765,40.360984696401;117.12005282882,40.360590562798;117.11964327235,40.359149306604;117.11925009607,40.35850167639;117.11906066925,40.358372619137;117.11857928748,40.35818147266;117.11808121493,40.357827775942;117.11771790973,40.357672709485;117.11626640017,40.357449529133;117.11539152477,40.357116055082;117.11477523114,40.357025056547;117.11435848813,40.356735210388;117.1142595829,40.356386093589;117.1143630789,40.355627130993;117.11456521403,40.355184432974;117.11533599083,40.35395627217;117.11565080014,40.353026213073;117.11567477524,40.352545191759;117.11550679869,40.352085595654;117.1151958749,40.351860539161;117.11457226136,40.351629101432;117.11422033336,40.351395220953;117.1141035297,40.351154922298;117.1139863097,40.350399421242;117.11375483183,40.349844722428;117.11353641636,40.349562241087;117.11320301818,40.348817974559;117.11257396993,40.348438454927;117.11233346218,40.34817964688;117.11193827005,40.347441339271;117.11166475667,40.346427751593;117.1115020364,40.346134524834;117.11094488934,40.346013213909;117.10925626887,40.346077294035;117.10840549166,40.345945652672;117.10760870925,40.346125625615;117.10701919045,40.346189151059;117.10601233816,40.346117977458;117.10447457184,40.345464671521;117.10410496228,40.345206618588;117.10362858015,40.34446481734;117.10279352804,40.343642871571;117.10233811709,40.342767451296;117.10217920365,40.342188350101;117.10215710027,40.341791822344;117.10222614216,40.341034951606;117.10232839703,40.340748876047;117.10246138,40.340452212911;117.10295753689,40.339754630251;117.10297441278,40.33960569096;117.10215891533,40.338388801269;117.10170521828,40.337464162644;117.1012806871,40.336926375397;117.10125107559,40.336338660279;117.1010690488,40.335653234413;117.10100224111,40.335402667303;117.10103670733,40.335048096389;117.1015975582,40.334535260543;117.10179457205,40.333563548003;117.10223857023,40.332622241018;117.1025428198,40.332164407735;117.10301033657,40.330990583553;117.10344179378,40.33072509126;117.10529593606,40.329905789243;117.10679430781,40.329491292394;117.10747890449,40.329035017534;117.10826146487,40.328221508768;117.10863344772,40.328319330724;117.10986570895,40.329231552371;117.11157298234,40.329816095797;117.11300459015,40.330701169718;117.11333352907,40.330854026897;117.11359672471,40.330889095434;117.11452045796,40.330419889837;117.11612945034,40.329056593945;117.11695911037,40.328523877104;117.11697380959,40.328344910086;117.11689989499,40.328261226486;117.11642366274,40.327974997771;117.11599219239,40.327500685371;117.11598499706,40.327332646445;117.11605466095,40.327238065004;117.11637203642,40.327172932272;117.11776077239,40.327374906139;117.11818113699,40.327332085475;117.11871507548,40.327434839151;117.11875286839,40.327343120927;117.11843508508,40.326948681699;117.11843968789,40.326677629595;117.1186693192,40.326585158051;117.11962937439,40.326443548523;117.12038345727,40.32579929015;117.12056146569,40.324281770116;117.12050420237,40.324143601958;117.11991799495,40.323767052287;117.11811204963,40.323105974335;117.11608556789,40.321803357429;117.11591680583,40.32175371499;117.1150350114,40.321795107899;117.11327037621,40.32096155877;117.11202155842,40.320960451742;117.11169146076,40.320895186795;117.11161161344,40.320707194756;117.11178632526,40.320110025505;117.11160168904,40.319917703228;117.11111904773,40.319844356625;117.11038923438,40.320153334388;117.11035836287,40.320053866196;117.11046377494,40.31989033267;117.1112238233,40.319556482537;117.11140890057,40.319370052614;117.11119140759,40.318365642598;117.11118978915,40.317766484302;117.11109041167,40.317150023872;117.11114309427,40.316871507639;117.11114637875,40.316297384865;117.11092156082,40.3157962027;117.1109367195,40.314866244984;117.11115774116,40.314705839989;117.1115932776,40.314642619341;117.11175645477,40.314377722317;117.11185769381,40.313989102379;117.11246113013,40.313340300457;117.11273842509,40.312817567268;117.11373766391,40.311903779174;117.11539026391,40.311001129042;117.11584176092,40.310627350818;117.11622019325,40.310068763666;117.11636152393,40.309507891918;117.11638297145,40.308766020654;117.11557616737,40.307830118028;117.1154372704,40.307444820949;117.11539624586,40.307063210461;117.11555745709,40.306715637256;117.11565824096,40.305482436405;117.11588238586,40.304907547409;117.11584518116,40.304516236576;117.11595763552,40.303778017955;117.11614585155,40.303108609854;117.11649178259,40.302545893158;117.11642982891,40.302454170238;117.11597567644,40.301916818183;117.11570410517,40.301466286117;117.11553447812,40.300996637782;117.11551546116,40.300590330214;117.11562642846,40.299866282081;117.11581395755,40.299271022394;117.11602791236,40.297601196114;117.11644374852,40.296787741992;117.11659734394,40.296089269539;117.11741917685,40.293715015146;117.11746599648,40.29354342912;117.11734015686,40.292354296171;117.11767847395,40.291507274575;117.11773773525,40.2904577742;117.11770100904,40.288700680656;117.11760642696,40.288453903884;117.11736388567,40.28821809404;117.11611300637,40.287813378245;117.11340945283,40.287494103643;117.1126968233,40.28734460139;117.11231524707,40.287092013962;117.11229035666,40.286602685528;117.11056473254,40.285448368594;117.11136630941,40.284714313884;117.11206313785,40.284189513597;117.11207811578,40.283535806362;117.11229338558,40.281874902138;117.11200262682,40.28127514576;117.11187341668,40.280666823533;117.11195440666,40.280347020883;117.11214364029,40.280124039662;117.11296065446,40.27923339515;117.11373461868,40.278696499558;117.11478379803,40.278278964519;117.11584597651,40.278212416941;117.11644949366,40.277879385535;117.11667746506,40.277221372536;117.11662304052,40.276660330626;117.11678996302,40.276270770247;117.11688152507,40.275476727196;117.11710704401,40.275220793218;117.11763103358,40.274859088231;117.11847466328,40.274478410612;117.11881747142,40.274216768611;117.11883082772,40.273521276956;117.1186388302,40.272801262214;117.11864281855,40.272588142233;117.11870896468,40.272459810129;117.11943318749,40.271865761213;117.11935291656,40.270900373174;117.11946901928,40.270350644233;117.11979511599,40.269863520287;117.12030455966,40.269344561282;117.12127978295,40.268899594399;117.12158366764,40.26861005718;117.12197191029,40.267685697563;117.12210433268,40.267178605963;117.12274948481,40.265985164575;117.12276737318,40.265160309273;117.12268164922,40.264994319799;117.12242990119,40.264778353217;117.12124211484,40.264826881197;117.11934557492,40.265169259274;117.11875159309,40.26512664375;117.11863403713,40.264971764515;117.11866914538,40.264768094564;117.11925136305,40.264376249246;117.11922152453,40.264171037797;117.11873249148,40.263919767066;117.12012016601,40.263079834858;117.12048769556,40.262929827034;117.12187520337,40.262762345461;117.12276260467,40.26257326608;117.12346387656,40.262587130125;117.12380869398,40.262507772975;117.1238708863,40.262380200612;117.12386017894,40.261962289556;117.12357357121,40.259241347787;117.12347573348,40.258950371004;117.12325321212,40.258690202348;117.12272166967,40.258294436909;117.12096518963,40.257305924804;117.12059725558,40.256947349058;117.11931107062,40.25673204277;117.11909655933,40.256611535835;117.11872074853,40.255898099373;117.1180734457,40.255369842173;117.11785402183,40.255067359169;117.11773714976,40.25407547788;117.11777550599,40.252754244224;117.11831270909,40.25101299088;117.11857366152,40.249613884521;117.1189337478,40.248424770701;117.11912755966,40.247389258609;117.11885742136,40.246996546753;117.11855098271,40.246716327937;117.11684897137,40.245483083285;117.11643098115,40.24527886967;117.11609788205,40.245204692523;117.11527190328,40.245301534242;117.1146130108,40.245083912857;117.11384206087,40.244936559834;117.11394331849,40.243059959203;117.11372998035,40.242660455047;117.11316170106,40.2420099356;117.11318059904,40.241067588914;117.11305432337,40.240360849892;117.11262274443,40.239760792767;117.11132622708,40.238506612047;117.11018577142,40.237684192689;117.10990015263,40.237554060105;117.10945582172,40.237482638239;117.10924554739,40.23746360079;117.10778813682,40.237885915502;117.1070431349,40.23795301133;117.10625237088,40.237996298386;117.10466036826,40.237937508299;117.10371645765,40.237824340865;117.10102559855,40.239143794773;117.09968380489,40.239437379463;117.09851808679,40.239954438782;117.09720106166,40.239761409518;117.0965856538,40.239839533925;117.09547070669,40.240170988495;117.09366137703,40.240252428873;117.0932779699,40.240557901439;117.09265850084,40.241461274233;117.09256268389,40.242684186104;117.09258725266,40.243336681674;117.09233026556,40.243506709063;117.09184015798,40.243434417476;117.09109827584,40.243170553006;117.08991071303,40.242599340169;117.08894911357,40.242440108344;117.08838121594,40.242168745523;117.08786284466,40.24207653937;117.08779023238,40.242247300228;117.0880620567,40.24319816532;117.088152725,40.244441379615;117.08813931193,40.245471275822;117.08799977999,40.245649582107;117.08773271419,40.245717834996;117.08645072607,40.245318636268;117.0848521313,40.245593774349;117.08364010292,40.245394716879";
        var ply = new BMap.Polygon(pos, PolygonOptions); //建立多边形覆盖物
        map.addOverlay(ply);  //添加覆盖物
        pointArray = pointArray.concat(ply.getPath());
        map.setViewport(pointArray);    //调整视野
    }

    /**
     * 添加地图边界demo
     */
    function setTestBoundaries()
    {
        var bdary = new BMap.Boundary();
        bdary.get("北京市海淀区", function(rs){       //获取行政区域
            map.clearOverlays();        //清除地图覆盖物
            var count = rs.boundaries.length; //行政区域的点有多少个
            if (count === 0) {
                alert('未能获取当前输入行政区域');
                return ;
            }
            var pointArray = [];
            for (var i = 0; i < count; i++) {
                var ply = new BMap.Polygon(rs.boundaries[i], ); //建立多边形覆盖物
                map.addOverlay(ply);  //添加覆盖物
                pointArray = pointArray.concat(ply.getPath());
            }
            map.setViewport(pointArray);    //调整视野
        });
    }

    //创建地图函数：
    function createMap(){
        var map = new BMap.Map("map");//在百度地图容器中创建一个地图
        // var point = new BMap.Point(116.330239,40.015832);//定义一个中心点坐标
        var point = new BMap.Point('117.063276,40.299265');//定义一个中心点坐标
        map.centerAndZoom(point,13);//设定地图的中心点和坐标并将地图显示在地图容器中
        //   map.enableScrollWheelZoom(false);
        window.map = map;//将map变量存储在全局
        // map.setMapStyle({style:"light"})
        var style = [
            // {
            //     "featureType": "land",
            //     "elementType": "all",
            //     "stylers": {
            //         "color": "#fff"
            //     }
            // },
            // {
            //     "featureType": "label",
            //     "elementType": "labels.text.fill",
            //     "stylers": {
            //         "visibility": "off"
            //     }
            // },
            // {
            //     "featureType": "water",
            //     "elementType": "labels.text.fill",
            //     "stylers": {
            //         "visibility": "off"
            //     }
            // },
            // {
            //     "featureType": "manmade",
            //     "elementType": "labels.text.fill",
            //     "stylers": {
            //         "visibility": "off",
            //     }
            // },
            // {
            //     "featureType": "building",
            //     "elementType": "labels.text.fill",
            //     "stylers": {
            //         "visibility": "off",
            //     }
            // },
            // {
            //     "featureType": "poilabel",
            //     "elementType": "labels.text.fill",
            //     "stylers": {
            //         "visibility": "off",
            //     }
            // },
            // {
            //     "featureType": "road",
            //     "elementType": "labels.text.fill",
            //     "stylers": {
            //         "visibility": "off",
            //     }
            // }
            {
                "featureType": "water",
                "elementType": "all",
                "stylers": {
                    "color": "#021019"
                }
            },
            {
                "featureType": "highway",
                "elementType": "geometry.fill",
                "stylers": {
                    "color": "#000000"
                }
            },
            {
                "featureType": "highway",
                "elementType": "geometry.stroke",
                "stylers": {
                    "color": "#147a92"
                }
            },
            {
                "featureType": "arterial",
                "elementType": "geometry.fill",
                "stylers": {
                    "color": "#000000"
                }
            },
            {
                "featureType": "arterial",
                "elementType": "geometry.stroke",
                "stylers": {
                    "color": "#0b3d51"
                }
            },
            {
                "featureType": "local",
                "elementType": "geometry",
                "stylers": {
                    "color": "#000000"
                }
            },
            {
                "featureType": "land",
                "elementType": "all",
                "stylers": {
                    "color": "#08304b"
                }
            },
            {
                "featureType": "railway",
                "elementType": "geometry.fill",
                "stylers": {
                    "color": "#000000"
                }
            },
            {
                "featureType": "railway",
                "elementType": "geometry.stroke",
                "stylers": {
                    "color": "#08304b"
                }
            },
            {
                "featureType": "subway",
                "elementType": "geometry",
                "stylers": {
                    "lightness": -70
                }
            },
            {
                "featureType": "building",
                "elementType": "geometry.fill",
                "stylers": {
                    "color": "#000000"
                }
            },
            {
                "featureType": "all",
                "elementType": "labels.text.fill",
                "stylers": {
                    "color": "#857f7f"
                }
            },
            {
                "featureType": "all",
                "elementType": "labels.text.stroke",
                "stylers": {
                    "color": "#000000"
                }
            },
            {
                "featureType": "building",
                "elementType": "geometry",
                "stylers": {
                    "color": "#022338"
                }
            },
            {
                "featureType": "green",
                "elementType": "geometry",
                "stylers": {
                    "color": "#062032"
                }
            },
            {
                "featureType": "boundary",
                "elementType": "all",
                "stylers": {
                    "color": "#1e1c1c"
                }
            },
            {
                "featureType": "manmade",
                "elementType": "geometry",
                "stylers": {
                    "color": "#022338"
                }
            },
            {
                "featureType": "poi",
                "elementType": "all",
                "stylers": {
                    "visibility": "off"
                }
            },
            {
                "featureType": "all",
                "elementType": "labels.icon",
                "stylers": {
                    "visibility": "off"
                }
            },
            {
                "featureType": "all",
                "elementType": "labels.text.fill",
                "stylers": {
                    "color": "#2da0c6",
                    "visibility": "on"
                }
            }
        ]
        map.setMapStyle({
            styleJson:style
        });
        setBoundaries();
    }

    function hiddenText()
    {
        var style = [{
            "featureType": "all",
            "elementType": "labels.text.fill",
            "stylers": {
                "visibility": "off"
            }
        }
        ]
        map.setMapStyle({
            styleJson:style
        });
    }

    //地图事件设置函数：
    function setMapEvent(){
        map.enableDragging();//启用地图拖拽事件，默认启用(可不写)
        //   map.enableScrollWheelZoom();//启用地图滚轮放大缩小
        //  map.enableDoubleClickZoom();//启用鼠标双击放大，默认启用(可不写)
        map.enableKeyboard();//启用键盘上下左右键移动地图
    }

    //地图控件添加函数：
    function addMapControl(){
        //向地图中添加缩放控件
        var ctrl_nav = new BMap.NavigationControl({anchor:BMAP_ANCHOR_TOP_LEFT,type:BMAP_NAVIGATION_CONTROL_LARGE});
        map.addControl(ctrl_nav);
        //向地图中添加缩略图控件
        var ctrl_ove = new BMap.OverviewMapControl({anchor:BMAP_ANCHOR_BOTTOM_RIGHT,isOpen:1});
        map.addControl(ctrl_ove);
        //向地图中添加比例尺控件
        var ctrl_sca = new BMap.ScaleControl({anchor:BMAP_ANCHOR_BOTTOM_LEFT});
        map.addControl(ctrl_sca);
    }

    //经纬度处理
    function  handelPos(pos){
        var weidu  =  pos.split(",")[0];
        var jingdu =  pos.split(",")[1];

        return jingdu + '|' + weidu;
    }

    var markerArr = [];
    var area   = [{"id":"8","name":"\u524d\u5317\u5bab\u6751","desc":"","pos":"40.249541,117.054842","user":"","admin":"","no":"110117105200","createtime":"2018-04-03 18:42:02","address":"","tel":"","street_code":"110117105000","icon":"{ w: 21, h: 21, l: 0, t: 0, x: 6, lb: 5 }"},{"id":"9","name":"\u540e\u5317\u5bab\u6751","desc":"","pos":"40.259672,117.060854","user":"","admin":"","no":"110117105201","createtime":"2018-04-03 18:48:48","address":"","tel":"","street_code":"110117105000","icon":"{ w: 21, h: 21, l: 0, t: 0, x: 6, lb: 5 }"},{"id":"10","name":"\u80dc\u5229\u6751","desc":"","pos":"40.266209,117.074202","user":"","admin":"","no":"110117105202","createtime":"2018-04-03 18:49:50","address":"","tel":"","street_code":"110117105000","icon":"{ w: 21, h: 21, l: 0, t: 0, x: 6, lb: 5 }"},{"id":"11","name":"\u9648\u5e84\u5b50\u6751","desc":"","pos":"40.268900,117.082500","user":"","admin":"","no":"110117105203","createtime":"2018-04-03 18:50:32","address":"","tel":"","street_code":"110117105000","icon":"{ w: 21, h: 21, l: 0, t: 0, x: 6, lb: 5 }"},{"id":"12","name":"\u82cf\u5b50\u5cea\u6751","desc":"","pos":"40.253505,117.098923","user":"","admin":"","no":"110117105204","createtime":"2018-04-03 18:51:59","address":"","tel":"","street_code":"110117105000","icon":"{ w: 21, h: 21, l: 0, t: 0, x: 6, lb: 5 }"},{"id":"13","name":"\u5c71\u95e8\u6c9f\u6751","desc":"","pos":"40.243473,117.102624","user":"","admin":"","no":"110117105205","createtime":"2018-04-03 18:53:02","address":"","tel":"","street_code":"110117105000","icon":"{ w: 21, h: 21, l: 0, t: 0, x: 6, lb: 5 }"},{"id":"14","name":"\u9ebb\u5b50\u5cea\u6751","desc":"","pos":"40.268500,117.101300","user":"","admin":"","no":"110117105206","createtime":"2018-04-03 18:54:04","address":"","tel":"","street_code":"110117105000","icon":"{ w: 21, h: 21, l: 0, t: 0, x: 6, lb: 5 }"},{"id":"15","name":"\u6302\u7532\u5cea\u6751","desc":"","pos":"40.272940,117.112300","user":"","admin":"","no":"110117105207","createtime":"2018-04-03 18:54:51","address":"","tel":"","street_code":"110117105000","icon":"{ w: 21, h: 21, l: 0, t: 0, x: 6, lb: 5 }"},{"id":"16","name":"\u5927\u534e\u5c71\u6751","desc":"","pos":"40.280361,117.079540","user":"","admin":"","no":"110117105208","createtime":"2018-04-03 18:55:37","address":"","tel":"","street_code":"110117105000","icon":"{ w: 21, h: 21, l: 0, t: 0, x: 6, lb: 5 }"},{"id":"17","name":"\u7816\u74e6\u7a91\u6751","desc":"","pos":"40.298412,117.083794","user":"","admin":"","no":"110117105209","createtime":"2018-04-03 18:56:24","address":"","tel":"","street_code":"110117105000","icon":"{ w: 21, h: 21, l: 0, t: 0, x: 6, lb: 5 }"},{"id":"18","name":"\u6cc9\u6c34\u5cea\u6751","desc":"","pos":"40.309657,117.094388","user":"","admin":"","no":"110117105210","createtime":"2018-04-03 18:57:10","address":"","tel":"","street_code":"110117105000","icon":"{ w: 21, h: 21, l: 0, t: 0, x: 6, lb: 5 }"},{"id":"19","name":"\u897f\u5cea\u6751","desc":"","pos":"40.325800,117.092900","user":"","admin":"","no":"110117105211","createtime":"2018-04-03 18:58:06","address":"","tel":"","street_code":"110117105000","icon":"{ w: 21, h: 21, l: 0, t: 0, x: 6, lb: 5 }"},{"id":"20","name":"\u897f\u957f\u5cea\u6751","desc":"","pos":"40.345399,117.085304","user":"","admin":"","no":"110117105212","createtime":"2018-04-03 18:58:49","address":"","tel":"","street_code":"110117105000","icon":"{ w: 21, h: 21, l: 0, t: 0, x: 6, lb: 5 }"},{"id":"21","name":"\u897f\u725b\u5cea\u6751","desc":"","pos":"40.333500,117.066686","user":"","admin":"","no":"110117105213","createtime":"2018-04-03 18:59:38","address":"","tel":"","street_code":"110117105000","icon":"{ w: 21, h: 21, l: 0, t: 0, x: 6, lb: 5 }"},{"id":"22","name":"\u74e6\u5b98\u5934\u6751","desc":"","pos":"40.316674,117.072901","user":"","admin":"","no":"110117105214","createtime":"2018-04-03 19:00:18","address":"","tel":"","street_code":"110117105000","icon":"{ w: 21, h: 21, l: 0, t: 0, x: 6, lb: 5 }"},{"id":"23","name":"\u68af\u5b50\u5cea\u6751","desc":"","pos":"40.323085,117.053729","user":"","admin":"","no":"110117105215","createtime":"2018-04-03 19:01:10","address":"","tel":"","street_code":"110117105000","icon":"{ w: 21, h: 21, l: 0, t: 0, x: 6, lb: 5 }"},{"id":"24","name":"\u674e\u5bb6\u5cea\u6751","desc":"","pos":"40.331195,117.029845","user":"","admin":"","no":"110117105216","createtime":"2018-04-03 19:01:52","address":"","tel":"","street_code":"110117105000","icon":"{ w: 21, h: 21, l: 0, t: 0, x: 6, lb: 5 }"},{"id":"25","name":"\u4e1c\u8f9b\u649e\u6751","desc":"","pos":"40.304450,117.050774","user":"","admin":"","no":"110117105217","createtime":"2018-04-03 19:02:38","address":"","tel":"","street_code":"110117105000","icon":"{ w: 21, h: 21, l: 0, t: 0, x: 6, lb: 5 }"},{"id":"26","name":"\u5927\u5cea\u5b50\u6751","desc":"","pos":"40.278430,117.053674","user":"","admin":"","no":"110117105218","createtime":"2018-04-03 19:03:52","address":"","tel":"","street_code":"110117105000","icon":"{ w: 21, h: 21, l: 0, t: 0, x: 6, lb: 5 }"},{"id":"27","name":"\u5c0f\u5cea\u5b50\u6751","desc":"","pos":"40.270700,117.040700","user":"","admin":"","no":"110117105219","createtime":"2018-04-03 19:04:42","address":"","tel":"","street_code":"110117105000","icon":"{ w: 21, h: 21, l: 0, t: 0, x: 6, lb: 5 }"}];
    var count  = 100;
    if(area.length > 0 ) {
        for (i in area) {
            //初始化各社区的备注信息
            var str = ''
            str += '<table border="1">';
            str += '<tr><td>检测人数</td><td colspan=" 2" id="' + area[i]["no"] + '_total">0人</td></tr>';
            str += '<tr><td rowspan="4">性别</td></tr>';
            str += '<tr><td>男</td> <td id="' + area[i]["no"] + '_nan">0人</td></tr>';
            str += '<tr><td>女</td> <td id="' + area[i]["no"] + '_nv">0人</td></tr>';
            str += '<tr><td>未知</td> <td id="' + area[i]["no"] + '_weizhi">0人</td></tr>';
            str += '</table>';

            if (typeof(count[area[i]['no']]) != 'undefined' && count[area[i]['no']] != '') {
                var str = ''
                str += '<table border="1">';
                str += '<tr><td >检测人数</td><td colspan=" 2" id="' + area[i]["no"] + '_total">' + count[area[i]['no']]['total'] + '人</td></tr>';
                str += '<tr><td rowspan="4">性别</td></tr>';
                str += '<tr><td >男</td> <td id="' + area[i]["no"] + '_nan">' + count[area[i]['no']]['nan'] + '</td></tr>';
                str += '<tr><td >女</td> <td id="' + area[i]["no"] + '_nv">' + count[area[i]['no']]['nv'] + '</td></tr>';
                str += '<tr><td >未知</td> <td id="' + area[i]["no"] + '_weizhi">' + count[area[i]['no']]['weizhi'] + '</td></tr>';
                str += '</table>';
            }

            str += '<a  style="float:left;color:blue;cursor:pointer"  class="add_user" data-id="' + area[i]['id'] + '"   onclick="add_user('+ area[i]["no"]  +  ',&quot;' + area[i]["name"] +'&quot; )">添加用户</a>'
            str += '<a  style="float:right;color:blue;cursor:pointer" class="del_user" data-id="' + area[i]['id'] + '"   onclick="del_user('+ area[i]["no"]  + ',&quot;' + area[i]["name"] +' &quot;)">删除用户</a>'

            var pos = handelPos(area[i]['pos'])        //经纬度转换为 117.060854|40.259672  这种格式
            var icon = eval('(' + area[i]['icon'] + ')');  //字符串转对象
            //各社区浮层写入数据
            markerArr.push({title: area[i]['name'], content: str, point: pos, isOpen: 0, icon: icon});
        }
    }

    //创建marker
    function addMarker(){
        for(var i=0;i<markerArr.length;i++){
            var json = markerArr[i];
            var p0 = json.point.split("|")[0];
            var p1 = json.point.split("|")[1];
            var point = new BMap.Point(p0,p1);
            var iconImg = createIcon('');
            var marker = new BMap.Marker(point,{icon:iconImg}); //创建标注

            var iw = createInfoWindow(i);
            var label = new BMap.Label(json.title,{"offset":new BMap.Size(-25,0)});
            marker.setLabel(label);
            map.addOverlay(marker); //将标注加到地图中

            label.setStyle({
                color : "#000",
                fontSize : "13px",
                backgroundColor :"0.05",
                border:"2px solid #fff",
                borderRadius:"5px",
                fontWeight :"bold"
            });
        }
    }
    //创建InfoWindow
    function createInfoWindow(i){
        var json = markerArr[i];
        var iw = new BMap.InfoWindow("<b class='iw_poi_title' title='" + json.title + "'>" + json.title + "</b><div class='iw_poi_content'>"+json.content+"</div>");

        return iw;
    }
    //创建一个Icon
    function createIcon(json){
        var icon = new BMap.Icon("/new/shouhuan/images/qi.png", new BMap.Size(json.w,json.h),{imageOffset: new BMap.Size(-json.l,-json.t),infoWindowOffset:new BMap.Size(json.lb+5,1),offset:new BMap.Size(json.x,json.h)})
        return icon;
    }

    initMap();//创建和初始化地图


    //给社区添加用户
    function add_user(no,name){
        var index=layer.open({
            type: 2,
            title: name + '-添加用户',
            shadeClose: true,
            shade: 0.8,
            area: ['50%', '95%'],
            btn: ['添加', '关闭'],
            content: '/community/shequ/useradd?no=' + no + '&id='+$("#street_id").val(),
            yes:function(index, layero){
                //模拟提交
                layer.getChildFrame('.user-save', index).click();
            },
            btn2:function(index){ //关闭按钮
                refreshOver(no);
            },
            cancel: function(index){ //关闭弹窗右上角
                //刷新覆盖层
                refreshOver(no);
            }
        });

    }

    //刷新覆盖物
    function refreshOver(no){
        $.ajax({
            type: "get",
            url: "<?php echo \yii\helpers\Url::to(['/community/shequ/get-user-by-no']) ?>",
            data: {'no': no,'id': $("#street_id").val()},
            dataType: "json",
            success: function (data) {
                $("#"+ no + '_total').text(data[no]['total']);
                $("#"+ no + '_nan').text(data[no]['nan']);
                $("#"+ no + '_nv').text(data[no]['nv']);
                $("#"+ no + '_weizhi').text(data[no]['weizhi']);
            }
        })
    }

    //给社区删除用户
    function del_user(no,name){
        var index=layer.open({
            type: 2,
            title: name + '-删除用户',
            shadeClose: true,
            shade: 0.8,
            area: ['50%', '95%'],
            btn: ['删除', '关闭'],
            content: '/community/shequ/userdel?no=' + no + '&id='+$("#street_id").val(),
            yes:function(index, layero){
                //模拟提交
                layer.getChildFrame('.user-save', index).click();
            },
            btn2:function(index){ //关闭按钮
                refreshOver(no);
            },
            cancel: function(index){ //关闭弹窗右上角
                //刷新覆盖层
                refreshOver(no);
            }
        });
    }
